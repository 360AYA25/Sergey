#!/bin/bash

# üöÄ Pre-push hook - –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ push
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ .git/hooks/pre-push –∏ chmod +x

echo "üöÄ Running pre-push checks..."

# ============================================
# 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤–µ—Ç–∫–∞ –Ω–µ main/master
# ============================================

BRANCH=$(git symbolic-ref --short HEAD)

if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "master" ]; then
  echo ""
  echo "  ‚ö†Ô∏è  WARNING: You are pushing to $BRANCH branch!"
  echo ""
  read -p "  Are you sure you want to push to $BRANCH? (yes/no): " choice
  case "$choice" in
    yes|YES|Y|y )
      echo "  Proceeding with push to $BRANCH"
      ;;
    * )
      echo "  ‚ùå Push aborted."
      exit 1
      ;;
  esac
fi

# ============================================
# 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç WIP/TODO –∫–æ–º–º–∏—Ç–æ–≤
# ============================================

echo "  Checking for WIP/TODO commits..."

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–∏—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–ø—É—à–µ–Ω—ã
COMMITS=$(git log @{u}.. --oneline 2>/dev/null)

if echo "$COMMITS" | grep -qiE "WIP|TODO|FIXME|TEMP"; then
  echo ""
  echo "  ‚ö†Ô∏è  WARNING: Found WIP/TODO/FIXME commits:"
  echo "$COMMITS" | grep -iE "WIP|TODO|FIXME|TEMP"
  echo ""
  read -p "  Push anyway? (yes/no): " choice
  case "$choice" in
    yes|YES|Y|y )
      echo "  Proceeding with push"
      ;;
    * )
      echo "  ‚ùå Push aborted. Clean up commits and try again."
      exit 1
      ;;
  esac
fi

echo "‚úÖ Pre-push checks passed!"
echo ""
