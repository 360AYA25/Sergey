#!/bin/bash

# üìù Commit-msg hook - validates commit message format
# Installation: copy to .git/hooks/commit-msg and chmod +x

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

echo "üìù Checking commit message format..."

# ============================================
# Check format: <type>: <description>
# ============================================

# Allowed types
TYPES="feat|fix|docs|refactor|test|chore|style|perf"

# Check format
if ! echo "$COMMIT_MSG" | grep -qE "^($TYPES): .+"; then
  echo ""
  echo "  ‚ùå Invalid commit message format!"
  echo ""
  echo "  Format should be: <type>: <description>"
  echo ""
  echo "  Valid types:"
  echo "    feat:     New feature"
  echo "    fix:      Bug fix"
  echo "    docs:     Documentation"
  echo "    refactor: Code refactoring"
  echo "    test:     Tests"
  echo "    chore:    Routine tasks"
  echo "    style:    Formatting, style"
  echo "    perf:     Performance improvements"
  echo ""
  echo "  Examples:"
  echo "    feat: add voice handler with Whisper"
  echo "    fix: resolve barcode scanner bug"
  echo "    docs: update README with setup instructions"
  echo ""
  echo "  Your message:"
  echo "  \"$COMMIT_MSG\""
  echo ""
  exit 1
fi

# Check minimum description length
DESCRIPTION=$(echo "$COMMIT_MSG" | sed -E "s/^($TYPES): //")
if [ ${#DESCRIPTION} -lt 10 ]; then
  echo ""
  echo "  ‚ö†Ô∏è  Commit message description is too short (min 10 characters)"
  echo "  Your description: \"$DESCRIPTION\" (${#DESCRIPTION} chars)"
  echo ""
  exit 1
fi

echo "‚úÖ Commit message format is valid!"
echo ""
