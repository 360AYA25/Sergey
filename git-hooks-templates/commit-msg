#!/bin/bash

# üìù Commit-msg hook - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–∞
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ .git/hooks/commit-msg –∏ chmod +x

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

echo "üìù Checking commit message format..."

# ============================================
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞: <type>: <description>
# ============================================

# –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã
TYPES="feat|fix|docs|refactor|test|chore|style|perf"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
if ! echo "$COMMIT_MSG" | grep -qE "^($TYPES): .+"; then
  echo ""
  echo "  ‚ùå Invalid commit message format!"
  echo ""
  echo "  Format should be: <type>: <description>"
  echo ""
  echo "  Valid types:"
  echo "    feat:     New feature"
  echo "    fix:      Bug fix"
  echo "    docs:     Documentation"
  echo "    refactor: Code refactoring"
  echo "    test:     Tests"
  echo "    chore:    Routine tasks"
  echo "    style:    Formatting, style"
  echo "    perf:     Performance improvements"
  echo ""
  echo "  Examples:"
  echo "    feat: add voice handler with Whisper"
  echo "    fix: resolve barcode scanner bug"
  echo "    docs: update README with setup instructions"
  echo ""
  echo "  Your message:"
  echo "  \"$COMMIT_MSG\""
  echo ""
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—è
DESCRIPTION=$(echo "$COMMIT_MSG" | sed -E "s/^($TYPES): //")
if [ ${#DESCRIPTION} -lt 10 ]; then
  echo ""
  echo "  ‚ö†Ô∏è  Commit message description is too short (min 10 characters)"
  echo "  Your description: \"$DESCRIPTION\" (${#DESCRIPTION} chars)"
  echo ""
  exit 1
fi

echo "‚úÖ Commit message format is valid!"
echo ""
